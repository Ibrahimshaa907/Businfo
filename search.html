<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Search Buses</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f7f9fb;
    }
    h2 {
      color: #2c3e50;
    }
    input, button, select {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      max-width: 400px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    ul {
      list-style: none;
      padding: 0;
      max-width: 400px;
    }
    li {
      background: #eaeaea;
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h2>Search Buses</h2>

  <form id="searchForm">
    <input list="cities" id="fromCity" placeholder="From City" required />
    <input list="cities" id="toCity" placeholder="To City" required />
    <button type="submit">Search</button>
  </form>

  <datalist id="cities"></datalist>

  <h3>Results:</h3>
  <ul id="results"></ul>

  <script type="module">
    // Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD_wiVIk8FK4ZWq6UfZiBWZQMAifKykMnA",
      authDomain: "genbusstand.firebaseapp.com",
      databaseURL: "https://genbusstand-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "genbusstand",
      storageBucket: "genbusstand.appspot.com",
      messagingSenderId: "1052804508829",
      appId: "1:1052804508829:web:775f81c7855860c575b874"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const cities = [
      "Abbottabad", "Attock", "Bahawalnagar", "Bahawalpur", "Bannu", "Chakwal", "Chiniot", "Dera Ghazi Khan", "Dera Ismail Khan",
      "Faisalabad", "Gujranwala", "Gujrat", "Hyderabad", "Islamabad", "Jacobabad", "Jhang", "Jhelum", "Karachi", "Kasur",
      "Khairpur", "Khuzdar", "Kohat", "Lahore", "Larkana", "Mandi Bahauddin", "Mianwali", "Mirpur Khas", "Multan", "Muzaffargarh",
      "Muzaffarabad", "Nawabshah", "Nowshera", "Okara", "Peshawar", "Quetta", "Rahim Yar Khan", "Rawalpindi", "Sadiqabad",
      "Sahiwal", "Sargodha", "Sheikhupura", "Sialkot", "Sukkur", "Swat", "Thatta", "Vehari", "Zhob"
    ];

    // Populate datalist for autocomplete
    const datalist = document.getElementById("cities");
    cities.forEach(city => {
      const option = document.createElement("option");
      option.value = city;
      datalist.appendChild(option);
    });

    document.getElementById("searchForm").addEventListener("submit", (e) => {
      e.preventDefault();

      const from = document.getElementById("fromCity").value.toLowerCase().trim();
      const to = document.getElementById("toCity").value.toLowerCase().trim();
      const resultList = document.getElementById("results");
      resultList.innerHTML = "Loading...";

      const busRef = ref(db, "buses");
      onValue(busRef, (snapshot) => {
        resultList.innerHTML = "";
        let found = false;

        snapshot.forEach((child) => {
          const data = child.val();
          const dbFrom = (data.From_city || "").toLowerCase();
          const dbTo = (data.To_city || "").toLowerCase();

          if (dbFrom.includes(from) && dbTo.includes(to)) {
            found = true;
            const li = document.createElement("li");
            li.innerHTML = `
              <strong>${data.From_city} â†’ ${data.To_city}</strong><br/>
              Time: ${data.Time} | Fare: ${data.Fare}<br/>
              Company: ${data.Company} | Mobile: ${data.Mobile}
            `;
            resultList.appendChild(li);
          }
        });

        if (!found) {
          resultList.innerHTML = "<li>No matching buses found.</li>";
        }
      });
    });
  </script>
</body>
</html>
