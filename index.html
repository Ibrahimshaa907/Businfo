<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>General Bus Stand - Home</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    :root{--accent:#007bff;--accent-dark:#0056b3}
    body{background:#f8f9fa;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    .home-header{background:linear-gradient(90deg,var(--accent),var(--accent-dark));padding:28px 0;color:#fff}
    .home-header h1{margin:0;font-size:2rem;font-weight:700}
    .home-header p{margin:0.25rem 0 0;font-size:1rem;opacity:.95}

    /* Ad containers */
    .ad-top, .ad-hero, .ad-sidebar, .ad-footer, .ad-sticky {display:flex;justify-content:center;align-items:center;overflow:hidden}
    .ad-hero {margin:1rem 0;padding:10px;background:#fff;border-radius:6px;box-shadow:0 1px 4px rgba(0,0,0,.05)}
    .ad-sidebar {margin-top:1rem;padding:10px;background:#fff;border-radius:6px;box-shadow:0 1px 4px rgba(0,0,0,.05)}
    .ad-footer {margin:1.25rem 0;padding:10px;background:#fff;border-radius:6px}
    .ad-sticky {position:fixed;left:0;right:0;bottom:0;z-index:1050;background:#fff;padding:6px 8px;border-top:1px solid rgba(0,0,0,.08);box-shadow:0 -4px 12px rgba(0,0,0,.08)}
    .ad-sticky .close-sticky{position:absolute;right:10px;top:6px;background:transparent;border:0;font-size:18px;cursor:pointer}

    /* Autocomplete */
    .autocomplete-items {position:absolute;border:1px solid #ccc;z-index:99;background:#fff;max-height:220px;overflow-y:auto;width:100%}
    .autocomplete-items div{padding:10px;cursor:pointer}
    .autocomplete-items div:hover{background:#f1f1f1}

    .direct-link-button{padding:10px 18px;background:#ff9800;color:#fff;border-radius:6px;text-decoration:none;display:inline-block}
    .card .card-title{font-weight:700}

    /* Make sure top visible area stays compact so ads are above the fold on most devices */
    @media(min-width:992px){
      .home-header{padding:36px 0}
    }
    @media(max-width:575px){
      .ad-hero{padding:6px}
      .home-header h1{font-size:1.25rem}
      .home-header p{font-size:.9rem}
      /* sticky ad height adjust */
      .ad-sticky{padding:8px}
    }

    /* small spacing for results so ad blocks are clear */
    #results .ad-inline {margin:12px 0}
  </style>
</head>
<body>

  <header class="home-header text-center">
    <div class="container">
      <h1>General Bus Stand</h1>
      <p class="lead">Find buses across Pakistan easily</p>
    </div>
  </header>

  <!-- Top banner ad (above the fold) -->
  <div class="container ad-top my-2">
    <!-- Adsterra top banner (keeps above fold) -->
    <div id="ad-top-slot">
      <script type="text/javascript">
        atOptions = {
          'key' : '189e766ae25e6de33f09b737fc1e2077',
          'format' : 'iframe',
          'height' : 90,
          'width' : '100%',
          'params' : {}
        };
      </script>
      <script type="text/javascript" src="//softballabnegatemailman.com/189e766ae25e6de33f09b737fc1e2077/invoke.js" async></script>
    </div>
  </div>

  <!-- Hero ad (large rectangle under header) -->
  <div class="container ad-hero">
    <div id="ad-hero-slot" style="width:100%;max-width:970px;">
      <!-- Use a responsive ad script / fallback link -->
      <script type='text/javascript' src='//softballabnegatemailman.com/cd/10/f5/cd10f5325cd3d95d1d691a3c97d55708.js' async></script>
    </div>
  </div>

  <main class="container mt-3 mb-5">
    <div class="row">
      <!-- Main content -->
      <div class="col-lg-8">
        <h2 class="text-primary text-center mb-3">Search Buses</h2>

        <form id="searchForm" class="row g-3 position-relative autocomplete">
          <div class="col-md-6 position-relative">
            <label for="fromCity" class="form-label">From City</label>
            <input type="text" id="fromCity" name="fromCity" class="form-control" required autocomplete="off" />
          </div>
          <div class="col-md-6 position-relative">
            <label for="toCity" class="form-label">To City</label>
            <input type="text" id="toCity" name="toCity" class="form-control" required autocomplete="off" />
          </div>
          <div class="col-12">
            <button type="submit" class="btn btn-primary w-100">Search</button>
          </div>
        </form>

        <!-- results -->
        <div id="results" class="mt-4"></div>
      </div>

      <!-- Sidebar (ads + quick buttons) -->
      <aside class="col-lg-4">
        <div class="ad-sidebar">
          <!-- Sidebar ad 1 (always visible near top) -->
          <div id="ad-side-1" style="width:300px;max-width:100%;">
            <script type='text/javascript' src='//softballabnegatemailman.com/2a/27/0d/2a270d7ace6ce95b19a24163ab836157.js' async></script>
          </div>
        </div>

        <div class="ad-sidebar">
          <!-- Sidebar clickable offer (fallback in case script blocked) -->
          <a href="https://softballabnegatemailman.com/ptmjctig7?key=6b17b7122638e98272085bcfc97d693b" target="_blank" class="direct-link-button">üöç Best Bus Offers</a>
        </div>

        <div class="ad-sidebar" style="margin-top:1rem;">
          <!-- small info / CTA area -->
          <div class="p-3 bg-white rounded shadow-sm text-center">
            <h6 style="margin:0 0 .5rem 0">Need help?</h6>
            <p style="margin:0;font-size:.9rem;color:#555">Contact admin for bus listings or to add a new route.</p>
            <a href="admin.html" class="btn btn-outline-primary btn-sm mt-2">Admin Panel</a>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <!-- Footer ad -->
  <div class="container ad-footer">
    <div id="ad-footer-slot" style="width:100%;max-width:900px;">
      <script type='text/javascript' src='//softballabnegatemailman.com/cd/10/f5/cd10f5325cd3d95d1d691a3c97d55708.js' async></script>
    </div>
  </div>

  <!-- Footer links -->
  <footer class="container text-center mt-4 mb-5">
    <div class="footer-links mb-2">
      <a href="about.html">About Us</a> |
      <a href="contact.html">Contact</a> |
      <a href="privacy.html">Privacy Policy</a> |
      <a href="disclaimer.html">Disclaimer</a> |
      <a href="terms.html">Terms & Conditions</a> |
      <a href="admin.html">Go to Admin Panel</a>
    </div>
    <p style="color:#6c757d;font-size:.9rem">&copy; 2025 GeneralBusStand</p>
  </footer>

  <!-- Sticky bottom ad (mobile friendly) -->
  <div id="stickyAd" class="ad-sticky" aria-hidden="false">
    <button class="close-sticky" title="Close" onclick="document.getElementById('stickyAd').style.display='none'">&times;</button>
    <div id="sticky-ad-slot" style="width:320px;max-width:100%;">
      <!-- mobile sticky ad script -->
      <script async="async" data-cfasync="false" src="//softballabnegatemailman.com/d00b43533f7f92a04cb15b777113bd96/invoke.js"></script>
      <div id="container-d00b43533f7f92a04cb15b777113bd96"></div>
    </div>
  </div>

  <!-- Location Auto-fill -->
  <script>
    window.addEventListener('load', () => {
      const fromInput = document.getElementById('fromCity');
      const locationMsg = document.createElement('p');
      locationMsg.className = 'text-muted small text-center';
      locationMsg.style.marginTop = '6px';
      locationMsg.innerText = 'üìç Allow location to auto-fill your city';
      fromInput.parentNode.appendChild(locationMsg);

      if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(async (position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          try {
            const res = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
            const data = await res.json();
            const city = data.city || data.locality || data.principalSubdivision;
            if (city) {
              fromInput.value = city;
              locationMsg.innerText = `üìç Detected city: ${city}`;
            } else {
              locationMsg.innerText = 'üìç City not found';
            }
          } catch {
            locationMsg.innerText = 'üìç Failed to detect city';
          }
        }, () => {
          locationMsg.innerText = 'üìç Location access denied';
        }, {timeout:7000});
      } else {
        locationMsg.innerText = 'üìç Browser does not support location';
      }
    });
  </script>

  <!-- Firebase + Search + Autocomplete (same logic, with inline ad insertion every 3 results) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD_wiVIk8FK4ZWq6UfZiBWZQMAifKykMnA",
      authDomain: "genbusstand.firebaseapp.com",
      databaseURL: "https://genbusstand-default-rtdb.asia-southeast1.firebasedatabase.app/",
      projectId: "genbusstand",
      storageBucket: "genbusstand.appspot.com",
      messagingSenderId: "1052804508829",
      appId: "1:1052804508829:web:775f81c7855860c575b874"
    };

    const app = initializeApp(firebaseConfig);
    const dbRef = ref(getDatabase(app));

    let cities = [];

    // fetch buses + prepare autocomplete
    get(child(dbRef, 'buses')).then(snapshot => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        const citiesSet = new Set();
        Object.values(data).forEach(bus => {
          if (bus.From_city) citiesSet.add(bus.From_city);
          if (bus.To_city) citiesSet.add(bus.To_city);
        });
        cities = Array.from(citiesSet).sort();
        setupAutocomplete("fromCity");
        setupAutocomplete("toCity");
      }
    }).catch(console.error);

    document.getElementById('searchForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const from = document.getElementById('fromCity').value.toLowerCase();
      const to = document.getElementById('toCity').value.toLowerCase();
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = "<p class='text-center'>Searching...</p>";

      try {
        const snapshot = await get(child(dbRef, 'buses'));
        if (snapshot.exists()) {
          const data = snapshot.val();
          const filtered = Object.values(data).filter(bus =>
            (bus.From_city || '').toLowerCase().includes(from) &&
            (bus.To_city || '').toLowerCase().includes(to)
          );

          if (filtered.length === 0) {
            resultsDiv.innerHTML = "<p class='text-center text-danger'>No results found.</p>";
            return;
          }

          resultsDiv.innerHTML = filtered.map((bus, index) => {
            let adBlock = '';
            if ((index + 1) % 3 === 0) {
              adBlock = `<div class="ad-inline text-center"><script async="async" data-cfasync="false" src="//softballabnegatemailman.com/d00b43533f7f92a04cb15b777113bd96/invoke.js"></script><div id="container-d00b43533f7f92a04cb15b777113bd96"></div></div>`;
            }
            return `
              <div class="card mb-3">
                <div class="card-body">
                  <h5 class="card-title">${bus.From_city} ‚ûù ${bus.To_city}</h5>
                  <p class="card-text">Time: ${bus.Time || '-'}<br>
                  Distance: ${bus.Distance || '-'}<br>
                  Company: ${bus.Company || '-'}<br>
                  Fare: ${bus.Fare || '-'}<br>
                  Stops: ${bus.Stops || '-'}<br>
                  Mobile: ${bus.Mobile || '-'}</p>
                </div>
              </div>
              ${adBlock}
            `;
          }).join('');
        } else {
          resultsDiv.innerHTML = "<p class='text-center text-danger'>No data found.</p>";
        }
      } catch (error) {
        resultsDiv.innerHTML = `<p class='text-center text-danger'>Error: ${error.message}</p>`;
      }
    });

    function setupAutocomplete(inputId) {
      const input = document.getElementById(inputId);
      input.addEventListener("input", function () {
        closeAllLists();
        const val = this.value;
        if (!val) return false;
        const list = document.createElement("div");
        list.setAttribute("id", this.id + "-autocomplete-list");
        list.setAttribute("class", "autocomplete-items");
        this.parentNode.appendChild(list);

        cities.filter(city => city.toLowerCase().startsWith(val.toLowerCase())).forEach(city => {
          const item = document.createElement("div");
          item.innerHTML = "<strong>" + city.substr(0, val.length) + "</strong>" + city.substr(val.length);
          item.addEventListener("click", function () {
            input.value = city;
            closeAllLists();
          });
          list.appendChild(item);
        });
      });

      function closeAllLists(elmnt) {
        const items = document.getElementsByClassName("autocomplete-items");
        for (let i = items.length - 1; i >= 0; i--) {
          if (elmnt != items[i] && elmnt != input) {
            if (items[i].parentNode) items[i].parentNode.removeChild(items[i]);
          }
        }
      }

      document.addEventListener("click", function (e) {
        closeAllLists(e.target);
      });
    }
  </script>

  <!-- small advisory about policies (not visible but good practice) -->
  <script>
    // Do not auto-click or ask users to click ads. Keep sticky ad closable.
    // The sticky ad close button above hides it when clicked.
  </script>

</body>
</html>
