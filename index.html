<!DOCTYPE html>
<html>
<head>
  <title>Bus Finder - GeneralBusStand</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial; margin: 20px; }
    input, select { padding: 8px; margin: 10px 0; width: 300px; }
    .card { border: 1px solid #ccc; border-radius: 10px; padding: 15px; margin: 10px 0; }
  </style>
</head>
<body>
  <h2>Find a Bus</h2>
  <input type="text" id="searchInput" placeholder="Search by city, company or stop...">
  <div id="busList"></div>

  <script>
    const supabase = supabase.createClient(
      'https://lkhhlpngexntgmzxafxn.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxraGhscG5nZXhudGdtenhhZnhuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1NTYwOTIsImV4cCI6MjA2OTEzMjA5Mn0.viDGnEjR2-eKdwglSF5oqToJI2YPuxIpbR4bVTJ88X0'
    );

    async function fetchBuses() {
      const { data, error } = await supabase.from('buses').select('*');
      if (error) {
        alert('Error fetching buses');
        return;
      }
      displayBuses(data);

      document.getElementById('searchInput').addEventListener('input', (e) => {
        const q = e.target.value.toLowerCase();
        const filtered = data.filter(b =>
          b.from_city.toLowerCase().includes(q) ||
          b.to_city.toLowerCase().includes(q) ||
          b.company.toLowerCase().includes(q) ||
          (b.stops && b.stops.toLowerCase().includes(q))
        );
        displayBuses(filtered);
      });
    }

    function displayBuses(buses) {
      const list = document.getElementById('busList');
      list.innerHTML = '';
      buses.forEach(b => {
        list.innerHTML += `
          <div class="card">
            <h3>${b.from_city} â†’ ${b.to_city}</h3>
            <p><strong>Time:</strong> ${b.time}</p>
            <p><strong>Distance:</strong> ${b.distance} km</p>
            <p><strong>Company:</strong> ${b.company}</p>
            <p><strong>Fare:</strong> Rs. ${b.fare}</p>
            <p><strong>Stops:</strong> ${b.stops || 'N/A'}</p>
          </div>
        `;
      });
    }

    fetchBuses();
  </script>
</body>
</html>
